WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
Login Succeeded
[Container] 2024/09/07 17:38:15.219209 Running command aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin 996142040734.dkr.ecr.us-east-1.amazonaws.com
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
Login Succeeded
[Container] 2024/09/07 17:38:15.904672 Running command docker login --username $NEXUS_USERNAME --password $NEXUS_PASSWORD dockerbuildoutputexternal.thehartford.com
WARNING! Using --password via the CLI is insecure. Use --password-stdin.
WARNING! Your password will be stored unencrypted in /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
Login Succeeded
[Container] 2024/09/07 17:38:16.127422 Phase complete: PRE_BUILD State: SUCCEEDED
[Container] 2024/09/07 17:38:16.127443 Phase context status code:  Message: 
[Container] 2024/09/07 17:38:16.162103 Entering phase BUILD
[Container] 2024/09/07 17:38:16.163085 Running command echo "[image build]"
[image build]
[Container] 2024/09/07 17:38:16.171242 Running command cd fta-bedrock-image
[Container] 2024/09/07 17:38:16.177391 Running command pwd
/codebuild/output/src1340/src/codestar-connections.us-east-1.amazonaws.com/git-http/570315879108/us-east-1/b00b6e1c-9a17-4eb4-975d-c355b0dbba37/HIG/cio_automationengineering_ragaas_app/fta-bedrock-image
[Container] 2024/09/07 17:38:16.183576 Running command ls -al
total 16
drwxr-xr-x 2 root root   88 Sep  7 17:37 .
drwxr-xr-x 6 root root  105 Sep  7 17:37 ..
-rw-r--r-- 1 root root 1354 Sep  7 17:37 Dockerfile
-rw-r--r-- 1 root root    1 Sep  7 17:37 README.md
-rw-r--r-- 1 root root 1106 Sep  7 17:37 build_image.sh
-rw-r--r-- 1 root root 1134 Sep  7 17:37 buildspec.dev.yml
[Container] 2024/09/07 17:38:16.190758 Running command chmod +x build_image.sh
[Container] 2024/09/07 17:38:16.198268 Running command ./build_image.sh .
#0 building with "default" instance using docker driver
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 1.39kB done
#1 DONE 0.1s
#2 [internal] load metadata for dockerbuildoutputexternal.thehartford.com/byoi/python:3.8-slim-buster
#2 ...
#3 [auth] sharing credentials for dockerbuildoutputexternal.thehartford.com
#3 DONE 0.0s
#2 [internal] load metadata for dockerbuildoutputexternal.thehartford.com/byoi/python:3.8-slim-buster
#2 DONE 0.2s
#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s
#5 [internal] load build context
#5 transferring context: 2B done
#5 DONE 0.0s
#6 [ 1/10] FROM dockerbuildoutputexternal.thehartford.com/byoi/python:3.8-slim-buster@sha256:90834dba6381dfc3957573dc7a3e6c5c8ed255cf60079329a6da2b5e6d4257b8
#6 resolve dockerbuildoutputexternal.thehartford.com/byoi/python:3.8-slim-buster@sha256:90834dba6381dfc3957573dc7a3e6c5c8ed255cf60079329a6da2b5e6d4257b8 0.0s done
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 0B / 27.14MB 0.1s
#6 sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c 0B / 2.78MB 0.1s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 0B / 12.89MB 0.1s
#6 sha256:90834dba6381dfc3957573dc7a3e6c5c8ed255cf60079329a6da2b5e6d4257b8 1.37kB / 1.37kB done
#6 sha256:addd6962740ab9fd79a788945daa24348c11adcec97d47a647e0a61c86cc9f60 6.87kB / 6.87kB done
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 2.10MB / 27.14MB 0.6s
#6 sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c 1.05MB / 2.78MB 0.6s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 2.10MB / 12.89MB 0.6s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 4.19MB / 27.14MB 0.8s
#6 sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c 2.10MB / 2.78MB 0.8s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 3.15MB / 12.89MB 0.8s
#6 sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c 2.78MB / 2.78MB 0.9s done
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 4.19MB / 12.89MB 0.9s
#6 sha256:cbfea27109a8b1136059a7973ccb8243889faf162ebc173a05909dcb0bec03c9 0B / 244B 0.9s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 6.29MB / 27.14MB 1.1s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 5.24MB / 12.89MB 1.1s
#6 sha256:cbfea27109a8b1136059a7973ccb8243889faf162ebc173a05909dcb0bec03c9 244B / 244B 0.9s done
#6 sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 0B / 3.14MB 1.1s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 6.29MB / 12.89MB 1.2s
#6 sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 1.05MB / 3.14MB 1.2s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 8.39MB / 27.14MB 1.4s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 7.34MB / 12.89MB 1.4s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 8.39MB / 12.89MB 1.6s
#6 sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 2.10MB / 3.14MB 1.6s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 10.49MB / 27.14MB 1.7s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 9.44MB / 12.89MB 1.7s
#6 sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 3.14MB / 3.14MB 1.6s done
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 10.49MB / 12.89MB 1.9s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 11.53MB / 12.89MB 2.0s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 12.58MB / 27.14MB 2.1s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 12.58MB / 12.89MB 2.1s
#6 sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 12.89MB / 12.89MB 2.2s done
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 14.68MB / 27.14MB 2.4s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 16.78MB / 27.14MB 2.7s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 19.92MB / 27.14MB 3.1s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 22.02MB / 27.14MB 3.5s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 25.17MB / 27.14MB 3.9s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 27.14MB / 27.14MB 4.2s
#6 sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 27.14MB / 27.14MB 4.2s done
#6 extracting sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3
#6 extracting sha256:8b91b88d557765cd8c6802668755a3f6dc4337b6ce15a17e4857139e5fc964f3 1.1s done
#6 extracting sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c
#6 extracting sha256:824416e234237961c9c5d4f41dfe5b295a3c35a671ee52889bfb08d8e257ec4c 0.1s done
#6 extracting sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 0.1s
#6 extracting sha256:8f777578c172d018077d3dc22d6654911fff60066097943fe8c4697ecf8aac35 0.4s done
#6 extracting sha256:cbfea27109a8b1136059a7973ccb8243889faf162ebc173a05909dcb0bec03c9
#6 extracting sha256:cbfea27109a8b1136059a7973ccb8243889faf162ebc173a05909dcb0bec03c9 done
#6 extracting sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 0.1s
#6 extracting sha256:276dfcf5deffff3c5d540a8e0d9a18656a4c03637a8b4f4eec1f4a147799c901 0.3s done
#6 DONE 6.7s
#7 [ 2/10] RUN echo "machine nexusrepodirect.thehartford.com\n"          "  login None\n"          "  password None\n" > ~/.netrc
#7 DONE 2.3s
#8 [ 3/10] RUN chmod 600 ~/.netrc
#8 DONE 0.3s
#9 [ 4/10] RUN sed --in-place --regexp-extended 's http https g' /etc/apt/sources.list
#9 DONE 0.4s
#10 [ 5/10] RUN apt-get -y update &#38;&#38; apt-get install -y --no-install-recommends     jq     unzip     gcc     g++     libc-dev     libffi-dev     moreutils
#10 1.207 Get:1 https://deb.debian.org/debian buster InRelease [122 kB]
#10 1.386 Get:2 https://deb.debian.org/debian-security buster/updates InRelease [34.8 kB]
#10 1.494 Get:3 https://deb.debian.org/debian buster-updates InRelease [56.6 kB]
#10 1.526 Get:4 https://deb.debian.org/debian buster/main amd64 Packages [7909 kB]
#10 3.197 Get:5 https://deb.debian.org/debian-security buster/updates/main amd64 Packages [610 kB]
#10 3.307 Get:6 https://deb.debian.org/debian buster-updates/main amd64 Packages [8788 B]
#10 4.251 Fetched 8741 kB in 4s (2203 kB/s)
#10 4.251 Reading package lists...
#10 4.818 Reading package lists...
#10 5.384 Building dependency tree...
#10 5.498 Reading state information...
#10 5.607 The following additional packages will be installed:
#10 5.607   binutils binutils-common binutils-x86-64-linux-gnu cpp cpp-8 g++-8 gcc-8
#10 5.607   libasan5 libatomic1 libbinutils libc-dev-bin libc6 libcc1-0 libgcc-8-dev
#10 5.607   libgdbm-compat4 libgomp1 libio-pty-perl libipc-run-perl libisl19 libitm1
#10 5.607   libjq1 liblsan0 libmpc3 libmpfr6 libmpx2 libonig5 libperl5.28 libquadmath0
#10 5.607   libstdc++-8-dev libtsan0 libubsan1 linux-libc-dev perl perl-modules-5.28
#10 5.608 Suggested packages:
#10 5.608   binutils-doc cpp-doc gcc-8-locales g++-multilib g++-8-multilib gcc-8-doc
#10 5.608   libstdc++6-8-dbg gcc-multilib make manpages-dev autoconf automake libtool
#10 5.608   flex bison gdb gcc-doc gcc-8-multilib libgcc1-dbg libgomp1-dbg libitm1-dbg
#10 5.608   libatomic1-dbg libasan5-dbg liblsan0-dbg libtsan0-dbg libubsan1-dbg
#10 5.608   libmpx2-dbg libquadmath0-dbg glibc-doc libc-l10n locales sensible-utils
#10 5.608   libstdc++-8-doc libtime-duration-perl libtimedate-perl perl-doc
#10 5.608   libterm-readline-gnu-perl | libterm-readline-perl-perl libb-debug-perl
#10 5.608   liblocale-codes-perl zip
#10 5.608 Recommended packages:
#10 5.608   manpages manpages-dev
#10 5.744 The following NEW packages will be installed:
#10 5.745   binutils binutils-common binutils-x86-64-linux-gnu cpp cpp-8 g++ g++-8 gcc
#10 5.745   gcc-8 jq libasan5 libatomic1 libbinutils libc-dev-bin libc6-dev libcc1-0
#10 5.745   libffi-dev libgcc-8-dev libgdbm-compat4 libgomp1 libio-pty-perl
#10 5.745   libipc-run-perl libisl19 libitm1 libjq1 liblsan0 libmpc3 libmpfr6 libmpx2
#10 5.745   libonig5 libperl5.28 libquadmath0 libstdc++-8-dev libtsan0 libubsan1
#10 5.746   linux-libc-dev moreutils perl perl-modules-5.28 unzip
#10 5.746 The following packages will be upgraded:
#10 5.747   libc6
#10 5.897 1 upgraded, 40 newly installed, 0 to remove and 23 not upgraded.
#10 5.897 Need to get 54.4 MB of archives.
#10 5.897 After this operation, 224 MB of additional disk space will be used.
#10 5.897 Get:1 https://deb.debian.org/debian buster/main amd64 perl-modules-5.28 all 5.28.1-6+deb10u1 [2873 kB]
#10 6.573 Get:2 https://deb.debian.org/debian-security buster/updates/main amd64 libc6 amd64 2.28-10+deb10u4 [2869 kB]
#10 7.193 Get:3 https://deb.debian.org/debian buster/main amd64 libgdbm-compat4 amd64 1.18.1-4 [44.1 kB]
#10 7.194 Get:4 https://deb.debian.org/debian buster/main amd64 libperl5.28 amd64 5.28.1-6+deb10u1 [3894 kB]
#10 8.016 Get:5 https://deb.debian.org/debian buster/main amd64 perl amd64 5.28.1-6+deb10u1 [204 kB]
#10 8.057 Get:6 https://deb.debian.org/debian buster/main amd64 binutils-common amd64 2.31.1-16 [2073 kB]
#10 8.486 Get:7 https://deb.debian.org/debian buster/main amd64 libbinutils amd64 2.31.1-16 [478 kB]
#10 8.656 Get:8 https://deb.debian.org/debian buster/main amd64 binutils-x86-64-linux-gnu amd64 2.31.1-16 [1823 kB]
#10 9.151 Get:9 https://deb.debian.org/debian buster/main amd64 binutils amd64 2.31.1-16 [56.8 kB]
#10 9.175 Get:10 https://deb.debian.org/debian buster/main amd64 libisl19 amd64 0.20-2 [587 kB]
#10 9.276 Get:11 https://deb.debian.org/debian buster/main amd64 libmpfr6 amd64 4.0.2-1 [775 kB]
#10 9.444 Get:12 https://deb.debian.org/debian buster/main amd64 libmpc3 amd64 1.1.0-1 [41.3 kB]
#10 9.449 Get:13 https://deb.debian.org/debian buster/main amd64 cpp-8 amd64 8.3.0-6 [8914 kB]
#10 11.30 Get:14 https://deb.debian.org/debian buster/main amd64 cpp amd64 4:8.3.0-1 [19.4 kB]
#10 11.30 Get:15 https://deb.debian.org/debian buster/main amd64 libcc1-0 amd64 8.3.0-6 [46.6 kB]
#10 11.30 Get:16 https://deb.debian.org/debian buster/main amd64 libgomp1 amd64 8.3.0-6 [75.8 kB]
#10 11.32 Get:17 https://deb.debian.org/debian buster/main amd64 libitm1 amd64 8.3.0-6 [27.7 kB]
#10 11.32 Get:18 https://deb.debian.org/debian buster/main amd64 libatomic1 amd64 8.3.0-6 [9032 B]
#10 11.33 Get:19 https://deb.debian.org/debian buster/main amd64 libasan5 amd64 8.3.0-6 [362 kB]
#10 11.40 Get:20 https://deb.debian.org/debian buster/main amd64 liblsan0 amd64 8.3.0-6 [131 kB]
#10 11.44 Get:21 https://deb.debian.org/debian buster/main amd64 libtsan0 amd64 8.3.0-6 [283 kB]
#10 11.49 Get:22 https://deb.debian.org/debian buster/main amd64 libubsan1 amd64 8.3.0-6 [120 kB]
#10 11.52 Get:23 https://deb.debian.org/debian buster/main amd64 libmpx2 amd64 8.3.0-6 [11.4 kB]
#10 11.52 Get:24 https://deb.debian.org/debian buster/main amd64 libquadmath0 amd64 8.3.0-6 [133 kB]
#10 11.55 Get:25 https://deb.debian.org/debian buster/main amd64 libgcc-8-dev amd64 8.3.0-6 [2298 kB]
#10 12.06 Get:26 https://deb.debian.org/debian buster/main amd64 gcc-8 amd64 8.3.0-6 [9452 kB]
#10 14.07 Get:27 https://deb.debian.org/debian buster/main amd64 gcc amd64 4:8.3.0-1 [5196 B]
#10 14.07 Get:28 https://deb.debian.org/debian-security buster/updates/main amd64 libc-dev-bin amd64 2.28-10+deb10u4 [276 kB]
#10 14.14 Get:29 https://deb.debian.org/debian-security buster/updates/main amd64 linux-libc-dev amd64 4.19.316-1 [1625 kB]
#10 14.49 Get:30 https://deb.debian.org/debian-security buster/updates/main amd64 libc6-dev amd64 2.28-10+deb10u4 [2694 kB]
#10 15.06 Get:31 https://deb.debian.org/debian buster/main amd64 libstdc++-8-dev amd64 8.3.0-6 [1532 kB]
#10 15.37 Get:32 https://deb.debian.org/debian buster/main amd64 g++-8 amd64 8.3.0-6 [9752 kB]
#10 17.37 Get:33 https://deb.debian.org/debian buster/main amd64 g++ amd64 4:8.3.0-1 [1644 B]
#10 17.38 Get:34 https://deb.debian.org/debian buster/main amd64 libonig5 amd64 6.9.1-1 [171 kB]
#10 17.41 Get:35 https://deb.debian.org/debian buster/main amd64 libjq1 amd64 1.5+dfsg-2+b1 [124 kB]
#10 17.43 Get:36 https://deb.debian.org/debian buster/main amd64 jq amd64 1.5+dfsg-2+b1 [59.4 kB]
#10 17.45 Get:37 https://deb.debian.org/debian buster/main amd64 libffi-dev amd64 3.2.1-9 [156 kB]
#10 17.55 Get:38 https://deb.debian.org/debian buster/main amd64 libio-pty-perl amd64 1:1.08-1.1+b5 [33.7 kB]
#10 17.57 Get:39 https://deb.debian.org/debian buster/main amd64 libipc-run-perl all 20180523.0-1 [101 kB]
#10 17.64 Get:40 https://deb.debian.org/debian buster/main amd64 moreutils amd64 0.62-1 [73.1 kB]
#10 17.65 Get:41 https://deb.debian.org/debian-security buster/updates/main amd64 unzip amd64 6.0-23+deb10u3 [172 kB]
#10 17.82 debconf: delaying package configuration, since apt-utils is not installed
#10 17.84 Fetched 54.4 MB in 12s (4557 kB/s)
#10 17.86 Selecting previously unselected package perl-modules-5.28.
#10 17.86 (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 6843 files and directories currently installed.)
#10 17.86 Preparing to unpack .../perl-modules-5.28_5.28.1-6+deb10u1_all.deb ...
#10 17.86 Unpacking perl-modules-5.28 (5.28.1-6+deb10u1) ...
#10 18.46 Preparing to unpack .../libc6_2.28-10+deb10u4_amd64.deb ...
#10 18.54 debconf: unable to initialize frontend: Dialog
#10 18.54 debconf: (TERM is not set, so the dialog frontend is not usable.)
#10 18.54 debconf: falling back to frontend: Readline
#10 18.65 Unpacking libc6:amd64 (2.28-10+deb10u4) over (2.28-10+deb10u2) ...
#10 20.23 Setting up libc6:amd64 (2.28-10+deb10u4) ...
#10 20.30 debconf: unable to initialize frontend: Dialog
#10 20.30 debconf: (TERM is not set, so the dialog frontend is not usable.)
#10 20.30 debconf: falling back to frontend: Readline
#10 21.39 Selecting previously unselected package libgdbm-compat4:amd64.
#10 21.39 (Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 8214 files and directories currently installed.)
#10 21.39 Preparing to unpack .../00-libgdbm-compat4_1.18.1-4_amd64.deb ...
#10 21.39 Unpacking libgdbm-compat4:amd64 (1.18.1-4) ...
#10 21.42 Selecting previously unselected package libperl5.28:amd64.
#10 21.42 Preparing to unpack .../01-libperl5.28_5.28.1-6+deb10u1_amd64.deb ...
#10 21.42 Unpacking libperl5.28:amd64 (5.28.1-6+deb10u1) ...
#10 22.07 Selecting previously unselected package perl.
#10 22.07 Preparing to unpack .../02-perl_5.28.1-6+deb10u1_amd64.deb ...
#10 22.08 Unpacking perl (5.28.1-6+deb10u1) ...
#10 22.11 Selecting previously unselected package binutils-common:amd64.
#10 22.11 Preparing to unpack .../03-binutils-common_2.31.1-16_amd64.deb ...
#10 22.11 Unpacking binutils-common:amd64 (2.31.1-16) ...
#10 22.30 Selecting previously unselected package libbinutils:amd64.
#10 22.30 Preparing to unpack .../04-libbinutils_2.31.1-16_amd64.deb ...
#10 22.30 Unpacking libbinutils:amd64 (2.31.1-16) ...
#10 22.37 Selecting previously unselected package binutils-x86-64-linux-gnu.
#10 22.37 Preparing to unpack .../05-binutils-x86-64-linux-gnu_2.31.1-16_amd64.deb ...
#10 22.37 Unpacking binutils-x86-64-linux-gnu (2.31.1-16) ...
#10 22.64 Selecting previously unselected package binutils.
#10 22.64 Preparing to unpack .../06-binutils_2.31.1-16_amd64.deb ...
#10 22.64 Unpacking binutils (2.31.1-16) ...
#10 22.67 Selecting previously unselected package libisl19:amd64.
#10 22.67 Preparing to unpack .../07-libisl19_0.20-2_amd64.deb ...
#10 22.67 Unpacking libisl19:amd64 (0.20-2) ...
#10 22.74 Selecting previously unselected package libmpfr6:amd64.
#10 22.74 Preparing to unpack .../08-libmpfr6_4.0.2-1_amd64.deb ...
#10 22.78 Unpacking libmpfr6:amd64 (4.0.2-1) ...
#10 22.82 Selecting previously unselected package libmpc3:amd64.
#10 22.82 Preparing to unpack .../09-libmpc3_1.1.0-1_amd64.deb ...
#10 22.83 Unpacking libmpc3:amd64 (1.1.0-1) ...
#10 22.84 Selecting previously unselected package cpp-8.
#10 22.85 Preparing to unpack .../10-cpp-8_8.3.0-6_amd64.deb ...
#10 22.85 Unpacking cpp-8 (8.3.0-6) ...
#10 23.60 Selecting previously unselected package cpp.
#10 23.60 Preparing to unpack .../11-cpp_4%3a8.3.0-1_amd64.deb ...
#10 23.60 Unpacking cpp (4:8.3.0-1) ...
#10 23.62 Selecting previously unselected package libcc1-0:amd64.
#10 23.62 Preparing to unpack .../12-libcc1-0_8.3.0-6_amd64.deb ...
#10 23.62 Unpacking libcc1-0:amd64 (8.3.0-6) ...
#10 23.65 Selecting previously unselected package libgomp1:amd64.
#10 23.65 Preparing to unpack .../13-libgomp1_8.3.0-6_amd64.deb ...
#10 23.65 Unpacking libgomp1:amd64 (8.3.0-6) ...
#10 23.67 Selecting previously unselected package libitm1:amd64.
#10 23.68 Preparing to unpack .../14-libitm1_8.3.0-6_amd64.deb ...
#10 23.68 Unpacking libitm1:amd64 (8.3.0-6) ...
#10 23.70 Selecting previously unselected package libatomic1:amd64.
#10 23.70 Preparing to unpack .../15-libatomic1_8.3.0-6_amd64.deb ...
#10 23.70 Unpacking libatomic1:amd64 (8.3.0-6) ...
#10 23.73 Selecting previously unselected package libasan5:amd64.
#10 23.73 Preparing to unpack .../16-libasan5_8.3.0-6_amd64.deb ...
#10 23.73 Unpacking libasan5:amd64 (8.3.0-6) ...
#10 23.78 Selecting previously unselected package liblsan0:amd64.
#10 23.78 Preparing to unpack .../17-liblsan0_8.3.0-6_amd64.deb ...
#10 23.79 Unpacking liblsan0:amd64 (8.3.0-6) ...
#10 23.82 Selecting previously unselected package libtsan0:amd64.
#10 23.82 Preparing to unpack .../18-libtsan0_8.3.0-6_amd64.deb ...
#10 23.82 Unpacking libtsan0:amd64 (8.3.0-6) ...
#10 23.86 Selecting previously unselected package libubsan1:amd64.
#10 23.87 Preparing to unpack .../19-libubsan1_8.3.0-6_amd64.deb ...
#10 23.87 Unpacking libubsan1:amd64 (8.3.0-6) ...
#10 23.90 Selecting previously unselected package libmpx2:amd64.
#10 23.90 Preparing to unpack .../20-libmpx2_8.3.0-6_amd64.deb ...
#10 23.90 Unpacking libmpx2:amd64 (8.3.0-6) ...
#10 23.92 Selecting previously unselected package libquadmath0:amd64.
#10 23.92 Preparing to unpack .../21-libquadmath0_8.3.0-6_amd64.deb ...
#10 23.93 Unpacking libquadmath0:amd64 (8.3.0-6) ...
#10 23.95 Selecting previously unselected package libgcc-8-dev:amd64.
#10 23.95 Preparing to unpack .../22-libgcc-8-dev_8.3.0-6_amd64.deb ...
#10 23.96 Unpacking libgcc-8-dev:amd64 (8.3.0-6) ...
#10 24.16 Selecting previously unselected package gcc-8.
#10 24.16 Preparing to unpack .../23-gcc-8_8.3.0-6_amd64.deb ...
#10 24.16 Unpacking gcc-8 (8.3.0-6) ...
#10 26.37 Preparing to unpack .../29-g++-8_8.3.0-6_amd64.deb ...
#10 26.37 Unpacking g++-8 (8.3.0-6) ...
#10 27.19 Selecting previously unselected package g++.
#10 27.19 Preparing to unpack .../30-g++_4%3a8.3.0-1_amd64.deb ...
#10 27.19 Unpacking g++ (4:8.3.0-1) ...
#10 27.21 Selecting previously unselected package libonig5:amd64.
#10 27.21 Preparing to unpack .../31-libonig5_6.9.1-1_amd64.deb ...
#10 27.21 Unpacking libonig5:amd64 (6.9.1-1) ...
#10 27.25 Selecting previously unselected package libjq1:amd64.
#10 27.25 Preparing to unpack .../32-libjq1_1.5+dfsg-2+b1_amd64.deb ...
#10 27.25 Unpacking libjq1:amd64 (1.5+dfsg-2+b1) ...
#10 27.28 Selecting previously unselected package jq.
#10 27.28 Preparing to unpack .../33-jq_1.5+dfsg-2+b1_amd64.deb ...
#10 27.28 Unpacking jq (1.5+dfsg-2+b1) ...
#10 27.30 Selecting previously unselected package libffi-dev:amd64.
#10 27.30 Preparing to unpack .../34-libffi-dev_3.2.1-9_amd64.deb ...
#10 27.31 Unpacking libffi-dev:amd64 (3.2.1-9) ...
#10 27.37 Selecting previously unselected package libio-pty-perl.
#10 27.37 Preparing to unpack .../35-libio-pty-perl_1%3a1.08-1.1+b5_amd64.deb ...
#10 27.37 Unpacking libio-pty-perl (1:1.08-1.1+b5) ...
#10 27.39 Selecting previously unselected package libipc-run-perl.
#10 27.39 Preparing to unpack .../36-libipc-run-perl_20180523.0-1_all.deb ...
#10 27.39 Unpacking libipc-run-perl (20180523.0-1) ...
#10 27.42 Selecting previously unselected package moreutils.
#10 27.42 Preparing to unpack .../37-moreutils_0.62-1_amd64.deb ...
#10 27.42 Unpacking moreutils (0.62-1) ...
#10 27.44 Selecting previously unselected package unzip.
#10 27.45 Preparing to unpack .../38-unzip_6.0-23+deb10u3_amd64.deb ...
#10 27.45 Unpacking unzip (6.0-23+deb10u3) ...
#10 27.49 Setting up perl-modules-5.28 (5.28.1-6+deb10u1) ...
#10 27.50 Setting up unzip (6.0-23+deb10u3) ...
#10 27.51 Setting up binutils-common:amd64 (2.31.1-16) ...
#10 27.51 Setting up linux-libc-dev:amd64 (4.19.316-1) ...
#10 27.52 Setting up libgomp1:amd64 (8.3.0-6) ...
#10 27.53 Setting up libffi-dev:amd64 (3.2.1-9) ...
#10 27.53 Setting up libasan5:amd64 (8.3.0-6) ...
#10 27.54 Setting up libmpfr6:amd64 (4.0.2-1) ...
#10 27.55 Setting up libquadmath0:amd64 (8.3.0-6) ...
#10 27.55 Setting up libmpc3:amd64 (1.1.0-1) ...
#10 27.56 Setting up libatomic1:amd64 (8.3.0-6) ...
#10 27.56 Setting up libgdbm-compat4:amd64 (1.18.1-4) ...
#10 27.57 Setting up libperl5.28:amd64 (5.28.1-6+deb10u1) ...
#10 27.58 Setting up libmpx2:amd64 (8.3.0-6) ...
#10 27.59 Setting up libubsan1:amd64 (8.3.0-6) ...
#10 27.59 Setting up libisl19:amd64 (0.20-2) ...
#10 27.60 Setting up libbinutils:amd64 (2.31.1-16) ...
#10 27.61 Setting up cpp-8 (8.3.0-6) ...
#10 27.62 Setting up libc-dev-bin (2.28-10+deb10u4) ...
#10 27.62 Setting up libcc1-0:amd64 (8.3.0-6) ...
#10 27.63 Setting up libonig5:amd64 (6.9.1-1) ...
#10 27.64 Setting up liblsan0:amd64 (8.3.0-6) ...
#10 27.65 Setting up libitm1:amd64 (8.3.0-6) ...
#10 27.65 Setting up binutils-x86-64-linux-gnu (2.31.1-16) ...
#10 27.66 Setting up libtsan0:amd64 (8.3.0-6) ...
#10 27.67 Setting up libjq1:amd64 (1.5+dfsg-2+b1) ...
#10 27.67 Setting up binutils (2.31.1-16) ...
#10 27.68 Setting up perl (5.28.1-6+deb10u1) ...
#10 27.69 Setting up libgcc-8-dev:amd64 (8.3.0-6) ...
#10 27.70 Setting up cpp (4:8.3.0-1) ...
#10 27.71 Setting up jq (1.5+dfsg-2+b1) ...
#10 27.72 Setting up libc6-dev:amd64 (2.28-10+deb10u4) ...
#10 27.72 Setting up libstdc++-8-dev:amd64 (8.3.0-6) ...
#10 27.73 Setting up gcc-8 (8.3.0-6) ...
#10 27.74 Setting up libio-pty-perl (1:1.08-1.1+b5) ...
#10 27.74 Setting up gcc (4:8.3.0-1) ...
#10 27.76 Setting up libipc-run-perl (20180523.0-1) ...
#10 27.77 Setting up g++-8 (8.3.0-6) ...
#10 27.77 Setting up moreutils (0.62-1) ...
#10 27.78 Setting up g++ (4:8.3.0-1) ...
#10 27.80 update-alternatives: using /usr/bin/g++ to provide /usr/bin/c++ (c++) in auto mode
#10 27.80 Processing triggers for libc-bin (2.28-10+deb10u2) ...
#10 DONE 28.0s
#11 [ 6/10] RUN python3.8 -m pip install --user     streamlit==1.28.2     dash==2.14.1     gunicorn==21.2.0     pandas     boto3     s3fs     numpy     fsspec     awscli==1.27.106
#11 1.629 Looking in indexes: https://nexusrepodirect.thehartford.com/repository/pypi_public/simple
#11 1.738 User for nexusrepodirect.thehartford.com: ERROR: Exception:
#11 1.742 Traceback (most recent call last):
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/cli/base_command.py", line 160, in exc_logging_wrapper
#11 1.742     status = run_func(*args)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/cli/req_command.py", line 247, in wrapper
#11 1.742     return func(self, options, args)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/commands/install.py", line 419, in run
#11 1.742     requirement_set = resolver.resolve(
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/resolver.py", line 92, in resolve
#11 1.742     result = self._result = resolver.resolve(
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/resolvelib/resolvers.py", line 481, in resolve
#11 1.742     state = resolution.resolve(requirements, max_rounds=max_rounds)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/resolvelib/resolvers.py", line 348, in resolve
#11 1.742     self._add_to_criteria(self.state.criteria, r, parent=None)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/resolvelib/resolvers.py", line 172, in _add_to_criteria
#11 1.742     if not criterion.candidates:
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/resolvelib/structs.py", line 151, in __bool__
#11 1.742     return bool(self._sequence)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 155, in __bool__
#11 1.742     return any(self)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 143, in <genexpr>
#11 1.742     return (c for c in iterator if id(c) not in self._incompatible_ids)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/found_candidates.py", line 44, in _iter_built
#11 1.742     for version, func in infos:
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/resolution/resolvelib/factory.py", line 279, in iter_index_candidate_infos
#11 1.742     result = self._finder.find_best_candidate(
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/package_finder.py", line 890, in find_best_candidate
#11 1.742     candidates = self.find_all_candidates(project_name)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/package_finder.py", line 831, in find_all_candidates
#11 1.742     page_candidates = list(page_candidates_it)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/sources.py", line 134, in page_candidates
#11 1.742     yield from self._candidates_from_page(self._link)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/package_finder.py", line 791, in process_project_url
#11 1.742     index_response = self._link_collector.fetch_response(project_url)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/collector.py", line 461, in fetch_response
#11 1.742     return _get_index_content(location, session=self.session)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/collector.py", line 364, in _get_index_content
#11 1.742     resp = _get_simple_response(url, session=session)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/index/collector.py", line 135, in _get_simple_response
#11 1.742     resp = session.get(
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/requests/sessions.py", line 600, in get
#11 1.742     return self.request("GET", url, **kwargs)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/network/session.py", line 518, in request
#11 1.742     return super().request(method, url, *args, **kwargs)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/requests/sessions.py", line 587, in request
#11 1.742     resp = self.send(prep, **send_kwargs)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/requests/sessions.py", line 708, in send
#11 1.742     r = dispatch_hook("response", hooks, r, **kwargs)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/requests/hooks.py", line 30, in dispatch_hook
#11 1.742     _hook_data = hook(hook_data, **kwargs)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/network/auth.py", line 388, in handle_401
#11 1.742     username, password, save = self._prompt_for_password(parsed.netloc)
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/network/auth.py", line 351, in _prompt_for_password
#11 1.742     username = ask_input(f"User for {netloc}: ")
#11 1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/utils/misc.py", line 205, in ask_input
#11 1.742     return input(message)
#11 1.742 EOFError: EOF when reading a line
#11 1.836 User for nexusrepodirect.thehartford.com: WARNING: There was an error checking the latest version of pip.
#11 ERROR: process "/bin/sh -c python3.8 -m pip install --user     streamlit==1.28.2     dash==2.14.1     gunicorn==21.2.0     pandas     boto3     s3fs     numpy     fsspec     awscli==1.27.106" did not complete successfully: exit code: 2
------
 > [ 6/10] RUN python3.8 -m pip install --user     streamlit==1.28.2     dash==2.14.1     gunicorn==21.2.0     pandas     boto3     s3fs     numpy     fsspec     awscli==1.27.106:
1.742   File "/usr/local/lib/python3.8/site-packages/pip/_vendor/requests/hooks.py", line 30, in dispatch_hook
1.742     _hook_data = hook(hook_data, **kwargs)
1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/network/auth.py", line 388, in handle_401
1.742     username, password, save = self._prompt_for_password(parsed.netloc)
1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/network/auth.py", line 351, in _prompt_for_password
1.742     username = ask_input(f"User for {netloc}: ")
1.742   File "/usr/local/lib/python3.8/site-packages/pip/_internal/utils/misc.py", line 205, in ask_input
1.742     return input(message)
1.742 EOFError: EOF when reading a line
1.836 User for nexusrepodirect.thehartford.com: WARNING: There was an error checking the latest version of pip.
------
Dockerfile:36
--------------------
  35 |     
  36 | >>> RUN python3.8 -m pip install --user \
  37 | >>>     streamlit==1.28.2 \
  38 | >>>     dash==2.14.1 \
  39 | >>>     gunicorn==21.2.0 \
  40 | >>>     pandas \
  41 | >>>     boto3 \
  42 | >>>     s3fs \
  43 | >>>     numpy \
  44 | >>>     fsspec \
  45 | >>>     awscli==1.27.106
  46 |     
--------------------
ERROR: failed to solve: process "/bin/sh -c python3.8 -m pip install --user     streamlit==1.28.2     dash==2.14.1     gunicorn==21.2.0     pandas     boto3     s3fs     numpy     fsspec     awscli==1.27.106" did not complete successfully: exit code: 2
The push refers to repository [570315879108.dkr.ecr.us-east-1.amazonaws.com/fta/snapshot/bedrock]
An image does not exist locally with the tag: 570315879108.dkr.ecr.us-east-1.amazonaws.com/fta/snapshot/bedrock
[Container] 2024/09/07 17:38:56.661157 Phase complete: BUILD State: SUCCEEDED
[Container] 2024/09/07 17:38:56.661177 Phase context status code:  Message: 
[Container] 2024/09/07 17:38:56.703683 Entering phase POST_BUILD
[Container] 2024/09/07 17:38:56.707582 Phase complete: POST_BUILD State: SUCCEEDED
[Container] 2024/09/07 17:38:56.707604 Phase context status code:  Message: 
[Container] 2024/09/07 17:38:56.802752 Set report auto-discover timeout to 5 seconds
[Container] 2024/09/07 17:38:56.802793 Expanding base directory path:  .
[Container] 2024/09/07 17:38:56.806265 Assembling file list
[Container] 2024/09/07 17:38:56.806279 Expanding .
[Container] 2024/09/07 17:38:56.809613 Expanding file paths for base directory .
[Container] 2024/09/07 17:38:56.809628 Assembling file list
[Container] 2024/09/07 17:38:56.809632 Expanding **/*
[Container] 2024/09/07 17:38:56.813712 No matching auto-discover report paths found
[Container] 2024/09/07 17:38:56.813814 Report auto-discover file discovery took 0.011061 seconds
[Container] 2024/09/07 17:38:56.813831 Phase complete: UPLOAD_ARTIFACTS State: SUCCEEDED
[Container] 2024/09/07 17:38:56.813839 Phase context status code:  Message: 


--
Dockerfile:
    FROM dockerbuildoutputexternal.thehartford.com/byoi/python:3.8-slim-buster

    MAINTAINER MLOps <MLOpsCoreTeam@thehartford.com>
    ARG REGION=us-east-1
    ARG ARG_PIP_INDEX=https://nexusrepodirect.thehartford.com/repository/pypi_public/pypi
    ARG ARG_PIP_INDEX_URL=https://nexusrepodirect.thehartford.com/repository/pypi_public/simple
    ARG ARG_PIP_TRUSTED_HOST=nexusrepodirect.thehartford.com

    #need to used service creds for actual container 
    ARG ARG_USERNAME=None 
    ARG ARG_PASSWORD=None

    #create .netrc for downstream usage 
    RUN echo "machine nexusrepodirect.thehartford.com\n" \
            "  login ${ARG_USERNAME}\n" \
            "  password ${ARG_PASSWORD}\n" > ~/.netrc
            
    RUN chmod 600 ~/.netrc

    ENV PIP_INDEX=$ARG_PIP_INDEX \
        PIP_INDEX_URL=$ARG_PIP_INDEX_URL \
        PIP_TRUSTED_HOST=$ARG_PIP_TRUSTED_HOST \
        PATH=/root/.local/bin:$PATH

    RUN sed --in-place --regexp-extended 's http https g' /etc/apt/sources.list

    RUN apt-get -y update && apt-get install -y --no-install-recommends \
        jq \
        unzip \
        gcc \
        g++ \
        libc-dev \
        libffi-dev \
        moreutils 

    RUN python3.8 -m pip install --user \
        streamlit==1.28.2 \
        dash==2.14.1 \
        gunicorn==21.2.0 \
        pandas \
        boto3 \
        s3fs \
        numpy \
        fsspec \
        awscli==1.27.106

    WORKDIR /utils 

    COPY container_utils/* /utils/

    RUN chmod +x /utils/entry.sh

    WORKDIR /app

    EXPOSE 8080

    ENTRYPOINT ["/utils/entry.sh"]
-----------------

buildspec:
version: 0.2

env:
  secrets-manager:
    NEXUS_USERNAME: arn:aws:secretsmanager:us-east-1:293176983353:secret:nexus-8ZgQUY:username
    NEXUS_PASSWORD: arn:aws:secretsmanager:us-east-1:293176983353:secret:nexus-8ZgQUY:password
  variables:
    PIP_TRUSTED_HOST: nexusrepodirect.thehartford.com
    PIP_INDEX: https://nexusrepodirect.thehartford.com/repository/pypi_public/pypi
    IMAGE_NAME: "app-4853-mlops-ui"
    IMAGE_VERSION: "1.0.3"
    AWS_ACCOUNT_ID_DEVOPS: 817209399767  

phases:
  install:
    runtime-versions:
      python: 3.8
    commands:
      - PIP_INDEX_URL=https://${NEXUS_USERNAME}:${NEXUS_PASSWORD}@nexusrepodirect.thehartford.com/repository/pypi_public/simple
  pre_build:
    commands:
      - echo "IMAGE NAME is ${IMAGE_NAME}"
      - echo "IMAGE VERSION is ${IMAGE_VERSION}"
      - echo "AWS_ACCOUNT_ID_DEVOPS is ${AWS_ACCOUNT_ID_DEVOPS}"

      - REPOSITORY_URI="${AWS_ACCOUNT_ID_DEVOPS}.dkr.ecr.${AWS_REGION}.amazonaws.com/${IMAGE_NAME}"
      - echo "REPOSITORY_URI to push images to is ${REPOSITORY_URI}"
      
  build:
    commands:
      - echo "Build started on $(date)"
      - echo "Building the Docker image..."
      - docker login dockerbuildoutputexternal.thehartford.com --username=${NEXUS_USERNAME} --password=${NEXUS_PASSWORD}
      - docker build -f dockerfile -t ${REPOSITORY_URI} -t ${REPOSITORY_URI}:${IMAGE_VERSION} --build-arg ARG_PIP_INDEX_URL=${PIP_INDEX_URL} --build-arg ARG_PIP_TRUSTED_HOST=${PIP_TRUSTED_HOST} --build-arg ARG_PIP_INDEX=${PIP_INDEX} --build-arg ARG_USERNAME=${NEXUS_USERNAME} --build-arg ARG_PASSWORD=${NEXUS_PASSWORD} .
      - echo "Build completed on $(date)"
  post_build:
    commands:
      - aws ecr get-login-password --region ${AWS_REGION}|docker login --username AWS --password-stdin 817209399767.dkr.ecr.us-east-1.amazonaws.com
      - echo "Pushing the Docker image..."
#     create your repository through the catalog service product!! this will give it the correct permissions and cross account access.
      - docker push ${REPOSITORY_URI}:${IMAGE_VERSION}


cache:
  paths:
    - "/root/.cache/pip/**/*"
------

build_image.sh

#!/usr/bin/env bash

# required env vars (buildspec)
set -u
: "$ECR_REPO_URI"
: "$ECR_REPO_NAME"

if [[ -z "$1" ]]; then
    echo "Usage: $0 <target_dir>"
    exit 1
fi
TARGET_DIR="$1"

# Declare _buildargs array before the loop
declare -a _buildargs

NEXUS_USERNAME=${NEXUS_USERNAME:= }
NEXUS_PASSWORD=${NEXUS_PASSWORD:= }

_workingdir=$(dirname $(readlink -f "$0"))
_dockerfile="$_workingdir/Dockerfile"

# Define _version
_version="1.0.0"

_buildargs+=("--build-arg NEXUS_USERNAME=$NEXUS_USERNAME")
_buildargs+=("--build-arg NEXUS_PASSWORD=$NEXUS_PASSWORD")
_buildargs+=("--build-arg PYTHON_VERSION=$_version")

# shellcheck disable=SC2068,SC2046
DOCKER_BUILDKIT=1 docker build \
    -f "$_dockerfile" \
    -t "$ECR_REPO_URI/$ECR_REPO_NAME:$_version" \
    ${_buildargs[@]} \
    --label APP_ID="$APP_ID" \
    --label GIT_COMMIT_SHA="$GIT_COMMIT_SHA" \
    --label CODEBUILD_BUILD_ID="$CODEBUILD_BUILD_ID" \
    .

# Push the image to the repository
docker push "$ECR_REPO_URI/$ECR_REPO_NAME:$_version"

if ! cd "$_workingdir"; then
    echo "Failed to change directory to $_workingdir"
    exit 1
fi
